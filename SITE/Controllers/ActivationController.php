<?php
namespace Controllers;

use Models\User;

final class ActivationController
{
    /**
     * Page d'activation de compte
     */
    public function activate(): void
    {
        $token = (string)($_GET['token'] ?? '');
        $errors = [];
        $success = '';
        $userName = '';

        if (empty($token)) {
            $errors[] = 'Lien d\'activation invalide. Le token est manquant.';
        } else {
            // V√©rifier si le token est valide
            $medecin = User::checkActivationToken($token);

            if (!$medecin) {
                $errors[] = 'Ce lien d\'activation est invalide ou a expir√©.';
                $errors[] = 'Les liens d\'activation sont valables 24 heures.';
                $errors[] = 'Si votre lien a expir√©, veuillez vous r√©inscrire ou contacter le support.';
            } else {
                // Token valide, on active le compte
                if (User::activateAccount($token)) {
                    $userName = $medecin['prenom'];
                    $success = 'F√©licitations ' . htmlspecialchars($userName) . ' ! üéâ<br><br>'
                        . 'Votre compte a √©t√© activ√© avec succ√®s.<br>'
                        . 'Vous pouvez maintenant vous connecter et profiter de DashMed.';
                } else {
                    $errors[] = 'Erreur lors de l\'activation du compte.';
                    $errors[] = 'Veuillez r√©essayer ou contacter le support technique.';
                }
            }
        }

        require __DIR__ . '/../Views/auth/activation.php';
    }
}